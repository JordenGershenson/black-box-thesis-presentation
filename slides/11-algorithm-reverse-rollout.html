      <div class="slide bg-surface" id="slide-11">
        <div class="title-zone">
          <h1>Algorithm: Reverse Attention Rollout</h1>
        </div>
        
        <div class="content-zone" style="gap: 12px;">
          <!-- Core Intuition -->
          <div class="card-accent" style="padding: 12px; border-radius: 6px;">
            <p style="font-size: 12px; font-weight: 600; color: var(--primary); margin-bottom: 6px;">Core Intuition</p>
            <p style="font-size: 11px; color: var(--muted-fg); line-height: 1.5;">
              Given a forecast output pixel, trace <strong>backward</strong> through the network's attention layers to determine which input locations contributed most. Like asking: "where did this prediction come from?"
            </p>
          </div>

          <div class="row gap-lg" style="flex: 1;">
            <!-- Left: Algorithm pseudocode -->
            <div class="col" style="flex: 1;">
              <div style="background: #1a1a2e; border-radius: 8px; padding: 14px; height: 100%;">
                <p style="font-size: 11px; color: rgba(255,255,255,0.8); margin-bottom: 10px; font-weight: 600;">Algorithm</p>

                <pre style="font-family: 'Courier New', monospace; font-size: 9px; color: #e2e8f0; line-height: 1.6; margin: 0; white-space: pre-wrap;"><span style="color: #7ad151;">function</span> <span style="color: #fde725;">ReverseAttentionRollout</span>(target_pixel):
    <span style="color: #718096;">// Initialize mass at output</span>
    mass[L] = zeros(output_shape)
    mass[L][target_pixel] = <span style="color: #fde725;">1.0</span>

    <span style="color: #718096;">// Propagate backward through layers</span>
    <span style="color: #7ad151;">for</span> layer <span style="color: #7ad151;">in</span> reverse(L-1, L-2, ..., 0):
        <span style="color: #718096;">// Get attention weights A[layer]</span>
        <span style="color: #718096;">// A[i,j] = how much token i attends to j</span>

        <span style="color: #718096;">// Distribute mass backward</span>
        mass[layer] = A[layer]<span style="color: #22a884;">ᵀ</span> @ mass[layer+1]

        <span style="color: #718096;">// Handle Swin-specific operations:</span>
        <span style="color: #7ad151;">if</span> window_shift:
            mass[layer] = <span style="color: #fde725;">UnshiftWindows</span>(mass[layer])

        <span style="color: #7ad151;">if</span> resolution_changed:
            mass[layer] = <span style="color: #fde725;">Upsample</span>(mass[layer])

    <span style="color: #7ad151;">return</span> mass[0]  <span style="color: #718096;">// Contribution map at input</span></pre>
              </div>
            </div>

            <!-- Right: Visual flow + key points -->
            <div class="col gap" style="flex: 0.85;">
              <!-- Simple visual -->
              <div style="background: var(--muted); border-radius: 8px; padding: 12px;">
                <p style="font-size: 10px; color: var(--muted-fg); margin-bottom: 10px; text-align: center; font-weight: 600;">Backward Propagation Flow</p>
                <div style="display: flex; align-items: center; justify-content: space-between; gap: 8px;">
                  <div style="text-align: center; flex: 1;">
                    <div style="background: var(--primary); color: white; padding: 8px; border-radius: 6px; margin-bottom: 4px;">
                      <div style="font-size: 18px; font-weight: bold;">X</div>
                      <div style="font-size: 8px;">Output</div>
                    </div>
                    <div style="font-size: 9px; color: var(--success); font-weight: bold;">mass = 1.0</div>
                  </div>

                  <div style="font-size: 24px; color: var(--accent);">←</div>

                  <div style="text-align: center; flex: 1;">
                    <div style="background: #2d4a6f; color: white; padding: 6px; border-radius: 6px; margin-bottom: 4px;">
                      <div style="font-size: 10px;">Layer 2</div>
                    </div>
                    <div style="font-size: 8px; color: var(--muted-fg);">Aᵀ @ mass</div>
                  </div>

                  <div style="font-size: 24px; color: var(--accent);">←</div>

                  <div style="text-align: center; flex: 1;">
                    <div style="background: #2d4a6f; color: white; padding: 6px; border-radius: 6px; margin-bottom: 4px;">
                      <div style="font-size: 10px;">Layer 1</div>
                    </div>
                    <div style="font-size: 8px; color: var(--muted-fg);">Aᵀ @ mass</div>
                  </div>

                  <div style="font-size: 24px; color: var(--accent);">←</div>

                  <div style="text-align: center; flex: 1;">
                    <div style="background: var(--success); color: white; padding: 8px; border-radius: 6px; margin-bottom: 4px;">
                      <div style="font-size: 10px;">Input</div>
                    </div>
                    <div style="font-size: 8px; color: var(--success); font-weight: bold;">Σ = 1.0</div>
                  </div>
                </div>
              </div>

              <!-- Key adaptations -->
              <div class="card" style="padding: 12px;">
                <p style="font-size: 11px; font-weight: 600; color: var(--primary); margin-bottom: 8px;">Swin-Specific Adaptations</p>
                <div style="margin-bottom: 6px;">
                  <p style="font-size: 10px; font-weight: 600; color: var(--accent);">1. Window Unshifting</p>
                  <p style="font-size: 9px; color: var(--muted-fg);">Reverses Swin's shifted-window partitioning</p>
                </div>
                <div style="margin-bottom: 6px;">
                  <p style="font-size: 10px; font-weight: 600; color: var(--accent);">2. Hierarchical Upsampling</p>
                  <p style="font-size: 9px; color: var(--muted-fg);">Handles resolution changes in patch merging layers</p>
                </div>
                <div>
                  <p style="font-size: 10px; font-weight: 600; color: var(--accent);">3. Transpose Attention</p>
                  <p style="font-size: 9px; color: var(--muted-fg);">Uses Aᵀ to reverse the attention flow direction</p>
                </div>
              </div>

              <!-- Mass preservation -->
              <div style="background: var(--success-light); padding: 10px; border-radius: 6px; border-left: 3px solid var(--success);">
                <p style="font-size: 10px; font-weight: 600; color: #276749; margin-bottom: 4px;">✓ Mass-Preserving Property</p>
                <p style="font-size: 9px; color: var(--muted-fg);">Total mass always sums to 1.0 → enables probabilistic interpretation of contributions</p>
              </div>

              <!-- Reference -->
              <div style="background: var(--muted); padding: 8px; border-radius: 6px; margin-top: auto;">
                <p style="font-size: 8px; color: var(--muted-fg); text-align: center;">
                  Based on Abnar & Zuidema (2020) • Extended for Swin architecture • Chapter 3
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>